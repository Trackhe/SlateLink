# _md5hash=cd7e87a642e98094bc7909f1568defda
# _version=27
# Dataplaneapi managed File
# changing file directly can cause a conflict if dataplaneapi is running

global
  chroot /var/lib/haproxy
  user haproxy
  group haproxy
  maxconn 4000
  pidfile /var/run/haproxy.pid
  # daemon
  stats socket /var/run/haproxy.sock mode 660 level admin
  # to have these messages end up in /var/log/haproxy.log you will
  # need to:
  # 1) configure syslog to accept network log events.  This is done
  # by adding the '-r' option to the SYSLOGD_OPTIONS in
  # /etc/sysconfig/syslog
  # 2) configure local2 events to go to the /var/log/haproxy.log
  # file. A line like the following can be added to
  # /etc/sysconfig/syslog
  # local2.*                       /var/log/haproxy.log
  log 127.0.0.1 local2

# ---------------------------------------------------------------------
# common defaults that all the 'listen' and 'backend' sections will
# use if not designated in their block
# ---------------------------------------------------------------------
defaults unnamed_defaults_1
  mode http
  maxconn 3000
  log global
  option httplog
  option redispatch
  option dontlognull
  option http-server-close
  option forwardfor except 127.0.0.0/8
  timeout http-request 10s
  timeout check 10s
  timeout connect 10s
  timeout client 1m
  timeout queue 1m
  timeout server 1m
  timeout http-keep-alive 10s
  retries 3

# ---------------------------------------------------------------------
# example how to define user and enable Data Plane API on tcp/5555
# more information: https://github.com/haproxytech/dataplaneapi and
# https://www.haproxy.com/documentation/hapee/2-0r1/configuration/dataplaneapi/
# ---------------------------------------------------------------------
userlist dataplaneapi
  user admin insecure-password 123Vorbei4
  # program api
  # command /usr/bin/dataplaneapi --host 0.0.0.0 --port 5555 --haproxy-bin /usr/sbin/haproxy --config-file /usr/local/etc/haproxy/haproxy.cfg --reload-cmd "kill -SIGUSR2 1" --restart-cmd "kill -SIGUSR2 1" --reload-delay 5 --userlist haproxy-dataplaneapi
  # no option start-on-reload
  # Frontend: Port 8080 (im Container) = von au√üen z. B. http://localhost (wenn 80:8080 gemappt)
  # frontend http_front from unnamed_defaults_1
  # bind *:8080
  # default_backend default_fallback
  # Backend: Webserver auf dem Host (Port 3000). Ohne "check" = kein Health-Check.
  # backend default_fallback from unnamed_defaults_1
  # server app host.docker.internal:3000

frontend test
  mode http
  maxconn 3000
  bind test:80 name bind_80
  bind *:8080 name bind_8080
  default_backend cert-manager

backend cert-manager
  mode http
  balance roundrobin
  server host_docker_internal host.docker.internal:3000 no-check
